#7DaysOfCode
# ğŸ› ï¸ Importar bibliotecas
import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns

# ğŸ“¥ Lista de links dos emprÃ©stimos (pode adicionar quantos quiser)
links_emprestimos = [
    'https://raw.githubusercontent.com/FranciscoFoz/7_Days_of_Code_Alura-Python-Pandas/refs/heads/main/Dia_1-Importando_dados/Datasets/dados_emprestimos/emprestimos-20101.csv',
    'https://raw.githubusercontent.com/FranciscoFoz/7_Days_of_Code_Alura-Python-Pandas/refs/heads/main/Dia_1-Importando_dados/Datasets/dados_emprestimos/emprestimos-20102.csv',
    'https://raw.githubusercontent.com/FranciscoFoz/7_Days_of_Code_Alura-Python-Pandas/refs/heads/main/Dia_1-Importando_dados/Datasets/dados_emprestimos/emprestimos-20111.csv',
    'https://raw.githubusercontent.com/FranciscoFoz/7_Days_of_Code_Alura-Python-Pandas/refs/heads/main/Dia_1-Importando_dados/Datasets/dados_emprestimos/emprestimos-20112.csv',
    'https://raw.githubusercontent.com/FranciscoFoz/7_Days_of_Code_Alura-Python-Pandas/refs/heads/main/Dia_1-Importando_dados/Datasets/dados_emprestimos/emprestimos-20122.csv',
    'https://raw.githubusercontent.com/FranciscoFoz/7_Days_of_Code_Alura-Python-Pandas/refs/heads/main/Dia_1-Importando_dados/Datasets/dados_emprestimos/emprestimos-20131.csv',
    'https://raw.githubusercontent.com/FranciscoFoz/7_Days_of_Code_Alura-Python-Pandas/refs/heads/main/Dia_1-Importando_dados/Datasets/dados_emprestimos/emprestimos-20132.csv',
    'https://raw.githubusercontent.com/FranciscoFoz/7_Days_of_Code_Alura-Python-Pandas/refs/heads/main/Dia_1-Importando_dados/Datasets/dados_emprestimos/emprestimos-20141.csv',
    'https://raw.githubusercontent.com/FranciscoFoz/7_Days_of_Code_Alura-Python-Pandas/refs/heads/main/Dia_1-Importando_dados/Datasets/dados_emprestimos/emprestimos-20142.csv',
    'https://raw.githubusercontent.com/FranciscoFoz/7_Days_of_Code_Alura-Python-Pandas/refs/heads/main/Dia_1-Importando_dados/Datasets/dados_emprestimos/emprestimos-20151.csv',
    'https://raw.githubusercontent.com/FranciscoFoz/7_Days_of_Code_Alura-Python-Pandas/refs/heads/main/Dia_1-Importando_dados/Datasets/dados_emprestimos/emprestimos-20152.csv',
    'https://raw.githubusercontent.com/FranciscoFoz/7_Days_of_Code_Alura-Python-Pandas/refs/heads/main/Dia_1-Importando_dados/Datasets/dados_emprestimos/emprestimos-20161.csv',
  
    # Adicione mais links aqui, separados por vÃ­rgula
]

# ğŸ“¥ Link dos exemplares
link_exemplares = 'https://raw.githubusercontent.com/FranciscoFoz/7_Days_of_Code_Alura-Python-Pandas/main/Dia_1-Importando_dados/Datasets/dados_exemplares.parquet'

# ğŸ“š Carregar todos os arquivos de emprÃ©stimos e concatenar
df_emprestimos_list = []

for link in links_emprestimos:
    df_temp = pd.read_csv(link)
    df_emprestimos_list.append(df_temp)

# Junta todos os DataFrames em um sÃ³
df_emprestimos = pd.concat(df_emprestimos_list, ignore_index=True)

# Carregar os dados dos exemplares
df_exemplares = pd.read_parquet(link_exemplares)

# ğŸ‘€ Verificando rapidamente os dados
print("Primeiras linhas dos emprÃ©stimos unificados:")
display(df_emprestimos.head())

print("\nPrimeiras linhas dos exemplares:")
display(df_exemplares.head())

# ğŸ“Œ Conferir nomes de colunas
print("\nColunas de emprÃ©stimos:")
print(df_emprestimos.columns)

print("\nColunas de exemplares:")
print(df_exemplares.columns)

# ğŸ§© Mesclar emprÃ©stimos e exemplares
# âš¡ AtenÃ§Ã£o: ajuste o 'on' se a coluna de ligaÃ§Ã£o tiver outro nome
df_unificado = pd.merge(df_emprestimos, df_exemplares, on='codigo_barras', how='inner')

# ğŸ“‹ Tamanho do DataFrame antes da limpeza
print(f"\nQuantidade de linhas antes da limpeza: {df_unificado.shape[0]}")

# ğŸ§¹ Limpar dados
df_unificado.dropna(inplace=True)
df_unificado.drop_duplicates(inplace=True)

# ğŸ“‹ Tamanho do DataFrame depois da limpeza
print(f"\nQuantidade de linhas depois da limpeza: {df_unificado.shape[0]}")

# ğŸ’¾ Salvar o resultado
df_unificado.to_csv('dados_unificados.csv', index=False)

print("\nâœ… Dados unificados, limpos e salvos como 'dados_unificados.csv'!")

# ğŸ¨ Configurar o estilo dos grÃ¡ficos
sns.set(style='whitegrid')
plt.rcParams['figure.figsize'] = (12, 6)

# ğŸ§© Carregar os dados unificados (caso nÃ£o tenha mantido o DataFrame em memÃ³ria)
df = pd.read_csv('dados_unificados.csv')

# ğŸ› ï¸ Se necessÃ¡rio, converter datas
# Supondo que existe uma coluna 'data_emprestimo'
df['data_emprestimo'] = pd.to_datetime(df['data_emprestimo'])

# ğŸ“ˆ GrÃ¡fico 1: EvoluÃ§Ã£o dos emprÃ©stimos ao longo dos anos
df['ano'] = df['data_emprestimo'].dt.year

emprestimos_por_ano = df['ano'].value_counts().sort_index()

plt.figure(figsize=(14, 7))
sns.lineplot(x=emprestimos_por_ano.index, y=emprestimos_por_ano.values, marker='o')
plt.title('ğŸ“š EvoluÃ§Ã£o dos EmprÃ©stimos ao Longo dos Anos', fontsize=18)
plt.xlabel('Ano')
plt.ylabel('Quantidade de EmprÃ©stimos')
plt.xticks(emprestimos_por_ano.index, rotation=45)
plt.show()

# ğŸ“ˆ GrÃ¡fico 2: Top 10 Bibliotecas com Mais EmprÃ©stimos
# Supondo que tenha uma coluna 'nome_biblioteca'
top_bibliotecas = df['biblioteca'].value_counts().head(10)

plt.figure(figsize=(14, 7))
sns.barplot(x=top_bibliotecas.values, y=top_bibliotecas.index, palette='viridis')
plt.title('ğŸ›ï¸ Top 10 Bibliotecas com Mais EmprÃ©stimos', fontsize=18)
plt.xlabel('Quantidade de EmprÃ©stimos')
plt.ylabel('Biblioteca')
plt.show()


print("\nâœ… Dashboard inicial gerado! Agora vocÃª tem uma visÃ£o geral poderosa dos seus dados.")

